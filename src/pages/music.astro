---
// src/pages/music.astro
import Layout from "../layouts/Layout.astro";
import SongTable from "../components/SongTable.jsx";
import FancyText from "../components/FancyText.jsx";
import SplashScreen from "../components/SplashScreen.jsx";
import supabase from "../lib/supabase";

// üì• consulta
const { data: rows, error } = await supabase
  .from("cantos")
  .select(
    `
    id,
    titulo,
    tono,
    autor,
    version,
    categorias:canto_categoria(
      categoria:categorias(nombre)
    )
  `,
  )
  .order("titulo", { ascending: true });

if (error) throw error;

// üîÑ adapta al shape que espera SongTable
const data = rows.map((r) => ({
  id: r.id,
  title: r.titulo,
  version: r.version,
  key: r.tono,
  author: r.autor,
  categories: r.categorias.map((c) => c.categoria.nombre),
}));
---

<Layout title="Lista de Canciones">
  <SplashScreen client:only="react" storageKey="visited-music" />
  <div class="min-h-screen bg-gradient-to-b from-gray-50 to-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="text-center mb-12">
        <FancyText
          text="Lista de Canciones"
          colors={["#3b82f6", "#8b5cf6", "#ec4899"]}
          animationSpeed={6}
          showBorder={false}
          className="text-5xl md:text-6xl font-extrabold tracking-tight mb-4"
          client:only="react"
        />
        <p class="text-gray-500 text-lg max-w-2xl mx-auto mt-4">
          Explora nuestra colecci√≥n de cantos, himnos y alabanzas. Usa el
          buscador o filtra por categor√≠as para encontrar lo que necesitas.
        </p>
      </div>

      <SongTable songs={data} client:only="react" />
    </div>
  </div>
</Layout>
